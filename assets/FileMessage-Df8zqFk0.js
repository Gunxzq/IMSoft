import{d as e,r as a,c as l,b as s,g as o,e as d,z as t,u as n,M as i,Y as u,D as r,U as c}from"./vendor-jjnROqEv.js";import{p as w}from"./index-DZvxyR4P.js";const f={class:"message-bubble"},v={class:"file-info"},p=["title"],m={class:"file-meta"},g={class:"file-size"},S={key:0,class:"progress"},U={class:"file-icon"},b=["src"],y=e({name:"FileMessage",props:{message:{}},setup(e){const y=e;let k=w(y.message.content),z=a({...y.message,fileName:k.fileName,fileSize:k.fileSize,fileUrl:k.fileUrl,typeIcon:k.typeIcon,previewUrl:k.previewUrl,downloadStatus:k.downloadStatus,progress:0});const N=l(()=>{switch(z.value.downloadStatus){case"downloading":return"下载中";case"downloaded":return"已下载";case"failed":return"下载失败";default:return"点击下载"}}),h=l(()=>({idle:"idle"===z.value.downloadStatus,downloading:"downloading"===z.value.downloadStatus,downloaded:"downloaded"===z.value.downloadStatus,failed:"failed"===z.value.downloadStatus})),j=async()=>{try{z.value.downloadStatus="downloading",z.value.progress=0;const e=await fetch(z.value.fileUrl),a=await e.blob();for(let o=0;o<=100;o+=10)z.value.progress=o,await new Promise(e=>setTimeout(e,500));const l=window.URL.createObjectURL(a),s=document.createElement("a");s.href=l,s.download=z.value.fileName,s.click(),window.URL.revokeObjectURL(l),z.value.downloadStatus="downloaded"}catch(e){z.value.downloadStatus="failed"}},L=()=>{"downloaded"===z.value.downloadStatus?window.open(z.value.fileUrl):"idle"===z.value.downloadStatus&&j()};return(e,a)=>(o(),s("div",f,[d("div",v,[d("div",{class:"file-name",onClick:L,title:n(z).fileName},i(n(z).fileName),9,p),d("div",m,[d("span",g,i(n(z).fileSize),1),d("span",{class:u(["status-tag",h.value])},[r(i(N.value)+" ",1),"downloading"===n(z).downloadStatus?(o(),s("span",S,i(n(z).progress)+"%",1)):t("",!0)],2)])]),d("div",U,[d("img",{src:n(z).typeIcon,alt:"文件类型"},null,8,b)]),"idle"===n(z).downloadStatus?(o(),s("button",{key:0,class:"download-btn",onClick:c(j,["stop"])},"下载")):t("",!0)]))}});export{y as default};
