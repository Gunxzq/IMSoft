import{d as a,r as e,c as s,w as l,b as r,g as t,e as u,z as o,I as n,u as v,U as i,J as d,n as p,M as c}from"./vendor-DtIIXuVc.js";import{p as y,_ as g}from"./index-BD3GTcF9.js";const m={class:"message-bubble"},S={key:0,class:"loading-overlay"},f={key:1,class:"error-overlay"},h=["src","poster"],b={key:2,class:"progress-bar"},k={class:"video-info"},x={class:"duration"},T={key:0,class:"playing-icon"},M=g(a({name:"VideoMessage",props:{message:{}},setup(a){const g=a;let M=y(g.message.content),w=e({...g.message,url:M.url,coverUrl:M.coverUrl,duration:M.duration,currentTime:0,playStatus:"idle"});const z=e(null),U=s(()=>`${Math.floor(w.value.duration/60)}:${(w.value.duration%60).toString().padStart(2,"0")}`),_=e(w.value.playStatus);l(()=>w.value.playStatus,a=>{_.value=a});const V=()=>{z.value&&"playing"===_.value&&z.value.pause()},j=()=>{_.value="playing",w.value.playStatus="playing"},B=()=>{_.value="paused",w.value.playStatus="paused"},C=()=>{_.value="paused",w.value.playStatus="paused",w.value.currentTime=0},E=()=>{z.value&&(w.value.currentTime=z.value.currentTime)},I=()=>{z.value&&(w.value.duration=z.value.duration,_.value="loaded")},L=a=>{_.value="error",w.value.playStatus="error"},P=()=>{z.value&&(z.value.load(),z.value.play().catch(()=>{_.value="error"}))};return(a,e)=>(t(),r("div",m,[u("div",{class:"video-container",onClick:V},["loading"===v(w).playStatus?(t(),r("div",S,e[0]||(e[0]=[u("div",{class:"spinner"},null,-1),u("span",{class:"loading-text"},"加载中...",-1)]))):"error"===v(w).playStatus?(t(),r("div",f,[e[1]||(e[1]=u("svg",{class:"error-icon",viewBox:"0 0 24 24"},[u("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})],-1)),e[2]||(e[2]=u("span",{class:"error-text"},"播放失败",-1)),u("button",{class:"retry-btn",onClick:i(P,["stop"])},"重试")])):o("",!0),n(u("video",{ref_key:"videoRef",ref:z,src:v(w).url,poster:v(w).coverUrl||"",class:"video-element",onTimeupdate:E,onLoadedmetadata:I,onPlay:j,onPause:B,onEnded:C,onError:L},null,40,h),[[d,"error"!==v(w).playStatus]]),"playing"===v(w).playStatus?(t(),r("div",b,[u("div",{class:"progress-fill",style:p({width:v(w).currentTime/v(w).duration*100+"%"})},null,4)])):o("",!0)]),u("div",k,[u("span",x,c(U.value),1),"playing"===v(w).playStatus?(t(),r("span",T,e[3]||(e[3]=[u("svg",{viewBox:"0 0 24 24"},[u("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"})],-1)]))):o("",!0)])]))}}),[["__scopeId","data-v-89e1c2ed"]]);export{M as default};
