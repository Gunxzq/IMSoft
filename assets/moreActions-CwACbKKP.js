import{p as e,s as a,a0 as t,d as i,r as l,a1 as s,b as n,g as o,F as r,e as c,i as d,C as u,j as m,D as g,M as p,W as f,X as h,u as b,U as v,z as y,f as w,k as I,B as U,a2 as _,l as k,A}from"./vendor-DtIIXuVc.js";import{g as E,e as F,E as R,M as S,_ as D}from"./index-BD3GTcF9.js";const L=[{name:"小",width:150,height:0},{name:"中",width:300,height:0},{name:"大",width:600,height:0}],z=e("upload",()=>{const e=a(new Map);async function i(a,i){let l=e.get(i);const s=l.findIndex(e=>e.id===a.id);if(-1!==s&&"pending"===a.status){l[s].status="processing";try{const e=await createImageBitmap(a.originalFile),i=e.width,n=e.height;e.close();const o=await Promise.all(L.map(async e=>new Promise(l=>{new t(a.originalFile,{quality:.8,width:e.width,height:e.height,mimeType:"image/webp",async success(a){const t=await createImageBitmap(a),i=t.width,s=t.height;t.close();const n=await new Promise((e,t)=>{try{const i=new FileReader;i.onerror=t,i.readAsDataURL(a),i.onload=()=>{const a=i.result;e(a)}}catch(i){}});l({size:e,blob:a,url:URL.createObjectURL(a),base64:n,actualSize:{width:i,height:s}})},error(){l({size:e,blob:a.originalFile.slice(0),url:a.originalUrl,actualSize:{width:i,height:n}})}})})));return l[s].thumbnails=o,l[s].originalAspectRatio=(i/n).toFixed(2),l[s].status="completed",o}catch(n){l[s].status="failed"}}}return{fileList:e,addFiles:function(a,t){e.has(t)||e.set(t,[]),a.forEach(a=>{e.get(t).push({id:E(),originalFile:a,originalUrl:URL.createObjectURL(a),originalSize:a.size,status:"pending"})})},startProcessing:async function(a,t){if(e.has(a)){let l=e.get(a);for(const e of l.filter(e=>"pending"===e.status)){t(await i(e,a))}}},clearFiles:function(a){if(e.has(a)){let t=e.get(a);t.forEach(e=>{e.originalUrl&&URL.revokeObjectURL(e.originalUrl),e.thumbnails&&e.thumbnails.forEach(e=>{e.url&&URL.revokeObjectURL(e.url)})}),t=[]}}}}),P={style:{display:"block"}},j={key:0,class:"placeholder"},M=D(i({name:"InputImage",props:{icon:String,label:String},emits:["change","remove","upload"],setup(e,{emit:t}){const i=z();let w=l(!1),I=a([]);const U=l(null),_=e=>{e.preventDefault()},k=e=>{e.preventDefault()},A=async e=>{const a=e.target;if(a.files){const e=Array.from(a.files).filter(e=>e.type.startsWith("image/"));i.addFiles(e,"Image"),i.startProcessing("Image",e=>{F.emit(R.API_SEND_MESSAGE,{content:e[0].base64,type:S.IMAGE})})}},E=async e=>{var a;if(e.preventDefault(),!e.dataTransfer)return;const{files:t}=e.dataTransfer;if(t&&0!==t.length&&(null==(a=e.dataTransfer)?void 0:a.files)){const a=Array.from(e.dataTransfer.files).filter(e=>e.type.startsWith("image/"));i.addFiles(a,"Image"),i.startProcessing("Image",e=>{F.emit(R.API_SEND_MESSAGE,{content:e[0].base64,type:S.IMAGE})})}},D=()=>{var e;try{null==(e=U.value)||e.click()}catch(a){}};return s(()=>{i.clearFiles("Image")}),(a,t)=>(o(),n(r,null,[c("div",{onClick:t[0]||(t[0]=e=>f(w)?w.value=!0:w=!0)},[d(u,{size:"40"},{default:m(()=>[g(p(e.icon),1)]),_:1}),c("span",P,p(e.label),1)]),d(h,{modelValue:b(w),"onUpdate:modelValue":t[2]||(t[2]=e=>f(w)?w.value=e:w=e)},{default:m(()=>[c("div",{class:"image-uploader",onClick:t[1]||(t[1]=e=>f(w)?w.value=!1:w=!1)},[c("div",{class:"upload-area",onDragover:v(_,["prevent"]),onDrop:v(E,["prevent"]),onDragleave:k,onClick:v(D,["stop"])},[c("input",{ref_key:"fileInput",ref:U,type:"file",accept:"image/*",multiple:"",onChange:A,style:{display:"none"}},null,544),0===b(I).length?(o(),n("div",j,"拖拽图片至此或点击上传")):y("",!0)],32)])]),_:1},8,["modelValue"])],64))}}),[["__scopeId","data-v-15c5e416"]]),C=D(i({name:"moreActions",setup(e){let a=[{icon:"mdi-image-outline",label:"照片",component:M},{icon:"mdi-phone-outline",label:"语音通话"},{icon:"mdi-video-outline",label:"视频通话"},{icon:"mdi-map-marker-outline",label:"位置"},{icon:"mdi-file-outline",label:"文件"},{icon:"mdi-star-outline",label:"收藏"},{icon:"mdi-cast-outline",label:"屏幕分享"},{icon:"mdi-account-outline",label:"名片"}];return(e,t)=>(o(),n("div",null,[d(A,null,{default:m(()=>[(o(!0),n(r,null,w(b(a),e=>(o(),I(U,{cols:"3",key:e.icon},{default:m(()=>[d(_,{elevation:"2",class:"card"},{default:m(()=>[(o(),I(k(e.component),{icon:e.icon,label:e.label},null,8,["icon","label"]))]),_:2},1024)]),_:2},1024))),128))]),_:1})]))}}),[["__scopeId","data-v-a50d767a"]]);export{C as default};
